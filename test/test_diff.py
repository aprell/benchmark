from bench.config import Config
from bench.diff import actual_diff, relative_diff


def test_actual_diff_a_b(capfd):
    actual_diff(["a/y 30 10", "b/y 30 10"], Config(), color=False)
    assert capfd.readouterr().out == \
"""
 a/y 30 10 vs b/y 30 10 (Run time (ms))
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     |  +8.95   |  +10.99  |  -46.04  |  -69.87  | -116.71  | -160.09  | -159.05  |
|    2     | +1607.34 | +1616.25 | +1618.98 | +1622.80 | +1646.79 | +1642.68 | +1655.53 |
|    4     | +1779.59 | +1781.14 | +2456.98 | +3011.18 | +3022.45 | +3078.80 | +3307.06 |
|    6     | +1523.77 | +1677.13 | +1826.51 | +1980.84 | +2043.90 | +2170.31 | +2316.84 |
|    8     | +1256.21 | +1313.89 | +1326.25 | +1492.19 | +1495.66 | +1556.87 | +1559.21 |
+----------+----------+----------+----------+----------+----------+----------+----------+
"""


def test_actual_diff_b_a(capfd):
    actual_diff(["b/y 30 10", "a/y 30 10"], Config(), color=False)
    assert capfd.readouterr().out == \
"""
 b/y 30 10 vs a/y 30 10 (Run time (ms))
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     |  -8.95   |  -10.99  |  +46.04  |  +69.87  | +116.71  | +160.09  | +159.05  |
|    2     | -1607.34 | -1616.25 | -1618.98 | -1622.80 | -1646.79 | -1642.68 | -1655.53 |
|    4     | -1779.59 | -1781.14 | -2456.98 | -3011.18 | -3022.45 | -3078.80 | -3307.06 |
|    6     | -1523.77 | -1677.13 | -1826.51 | -1980.84 | -2043.90 | -2170.31 | -2316.84 |
|    8     | -1256.21 | -1313.89 | -1326.25 | -1492.19 | -1495.66 | -1556.87 | -1559.21 |
+----------+----------+----------+----------+----------+----------+----------+----------+
"""


def test_relative_diff_a_b(capfd):
    relative_diff(["a/y 30 10", "b/y 30 10"], Config(), color=False)
    assert capfd.readouterr().out == \
"""
 a/y 30 10 vs b/y 30 10 (Run time (ms))
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     | +0.07 %  | +0.08 %  | -0.34 %  | -0.51 %  | -0.85 %  | -1.16 %  | -1.15 %  |
|    2     | +23.68 % | +23.80 % | +23.84 % | +23.89 % | +24.23 % | +24.14 % | +24.30 % |
|    4     | +52.08 % | +52.13 % | +71.88 % | +88.08 % | +88.39 % | +90.03 % | +96.70 % |
|    6     | +66.44 % | +73.11 % | +79.62 % | +86.31 % | +88.97 % | +94.35 % | +99.95 % |
|    8     | +72.20 % | +75.47 % | +76.15 % | +85.57 % | +85.64 % | +89.06 % | +89.19 % |
+----------+----------+----------+----------+----------+----------+----------+----------+
"""


def test_relative_diff_b_a(capfd):
    relative_diff(["b/y 30 10", "a/y 30 10"], Config(), color=False)
    assert capfd.readouterr().out == \
"""
 b/y 30 10 vs a/y 30 10 (Run time (ms))
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     | -0.07 %  | -0.08 %  | +0.34 %  | +0.51 %  | +0.85 %  | +1.17 %  | +1.16 %  |
|    2     | -19.14 % | -19.23 % | -19.25 % | -19.28 % | -19.51 % | -19.45 % | -19.55 % |
|    4     | -34.25 % | -34.27 % | -41.82 % | -46.83 % | -46.92 % | -47.38 % | -49.16 % |
|    6     | -39.92 % | -42.23 % | -44.33 % | -46.33 % | -47.08 % | -48.55 % | -49.99 % |
|    8     | -41.93 % | -43.01 % | -43.23 % | -46.11 % | -46.13 % | -47.11 % | -47.14 % |
+----------+----------+----------+----------+----------+----------+----------+----------+
"""
