## Setup

```console
$ make CC=clang
clang -Wall -Wextra -fopenmp -O0 matmul.c -o O0/matmul
clang -Wall -Wextra -fopenmp -O1 matmul.c -o O1/matmul
clang -Wall -Wextra -fopenmp -O2 matmul.c -o O2/matmul

$ cat bench.ini
[Benchmark]
benchmarks = O0/matmul, O1/matmul, O2/matmul
num_threads = 1, 2, 4, 8
repetitions = 3

[Time]
unit = s

[Environment]
OMP_PLACES = cores
OMP_PROC_BIND = close
OMP_NUM_THREADS = $NUM_THREADS
```

## bench --run

```console
$ bench --run --all
NUM_THREADS=1 O0/matmul: ...
NUM_THREADS=2 O0/matmul: ...
NUM_THREADS=4 O0/matmul: ...
NUM_THREADS=8 O0/matmul: ...
NUM_THREADS=1 O1/matmul: ...
NUM_THREADS=2 O1/matmul: ...
NUM_THREADS=4 O1/matmul: ...
NUM_THREADS=8 O1/matmul: ...
NUM_THREADS=1 O2/matmul: ...
NUM_THREADS=2 O2/matmul: ...
NUM_THREADS=4 O2/matmul: ...
NUM_THREADS=8 O2/matmul: ...
```

## bench --report

```console
$ bench --report --all

 O0/matmul (s)
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
| #Threads | Min  | P10  | P25  | Median | P75  | P90  | Max  | P75-P25 | P90-P10 | Max-Min |  Mean ± RSD   |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
|    1     | 3.01 | 3.01 | 3.02 |  3.03  | 3.06 | 3.08 | 3.09 |  0.04   |  0.06   |  0.08   | 3.04 ± 1.37 % |
|    2     | 1.82 | 1.84 | 1.86 |  1.91  | 1.97 | 2.01 | 2.03 |   0.1   |  0.17   |  0.21   | 1.92 ± 5.49 % |
|    4     | 1.27 | 1.28 | 1.29 |  1.3   | 1.31 | 1.32 | 1.32 |  0.02   |  0.04   |  0.05   | 1.3 ± 1.94 %  |
|    8     | 0.98 | 0.99 | 1.0  |  1.02  | 1.03 | 1.04 | 1.04 |  0.03   |  0.05   |  0.06   | 1.01 ± 3.01 % |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+

 O1/matmul (s)
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
| #Threads | Min  | P10  | P25  | Median | P75  | P90  | Max  | P75-P25 | P90-P10 | Max-Min |  Mean ± RSD   |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
|    1     | 0.62 | 0.62 | 0.62 |  0.63  | 0.65 | 0.66 | 0.67 |  0.03   |  0.04   |  0.05   | 0.64 ± 4.13 % |
|    2     | 0.36 | 0.37 | 0.38 |  0.39  | 0.4  | 0.4  | 0.4  |  0.02   |  0.03   |  0.04   | 0.38 ± 5.43 % |
|    4     | 0.24 | 0.24 | 0.24 |  0.25  | 0.26 | 0.27 | 0.27 |  0.02   |  0.02   |  0.03   | 0.25 ± 6.03 % |
|    8     | 0.17 | 0.17 | 0.17 |  0.17  | 0.17 | 0.17 | 0.17 |   0.0   |   0.0   |   0.0   | 0.17 ± 0.0 %  |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+

 O2/matmul (s)
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
| #Threads | Min  | P10  | P25  | Median | P75  | P90  | Max  | P75-P25 | P90-P10 | Max-Min |  Mean ± RSD   |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
|    1     | 0.34 | 0.34 | 0.34 |  0.34  | 0.35 | 0.36 | 0.36 |  0.01   |  0.02   |  0.02   | 0.35 ± 3.33 % |
|    2     | 0.17 | 0.17 | 0.17 |  0.18  | 0.18 | 0.19 | 0.19 |  0.01   |  0.02   |  0.02   | 0.18 ± 5.56 % |
|    4     | 0.13 | 0.13 | 0.13 |  0.13  | 0.14 | 0.14 | 0.14 |  0.01   |  0.01   |  0.01   | 0.13 ± 4.33 % |
|    8     | 0.08 | 0.08 | 0.08 |  0.08  | 0.08 | 0.08 | 0.08 |   0.0   |   0.0   |   0.0   | 0.08 ± 0.0 %  |
+----------+------+------+------+--------+------+------+------+---------+---------+---------+---------------+
```

## bench --diff

```console
$ bench --diff {O1,O0}/matmul

 O1/matmul vs O0/matmul
+----------+---------+---------+---------+---------+---------+---------+---------+
| #Threads |   Min   |   P10   |   P25   | Median  |   P75   |   P90   |   Max   |
+----------+---------+---------+---------+---------+---------+---------+---------+
|    1     | -2.39 s | -2.39 s | -2.40 s | -2.40 s | -2.41 s | -2.42 s | -2.42 s |
|    2     | -1.46 s | -1.47 s | -1.48 s | -1.52 s | -1.57 s | -1.61 s | -1.63 s |
|    4     | -1.03 s | -1.04 s | -1.05 s | -1.05 s | -1.05 s | -1.05 s | -1.05 s |
|    8     | -0.81 s | -0.82 s | -0.83 s | -0.85 s | -0.86 s | -0.87 s | -0.87 s |
+----------+---------+---------+---------+---------+---------+---------+---------+

 O1/matmul vs O0/matmul
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     | -79.40 % | -79.40 % | -79.47 % | -79.21 % | -78.76 % | -78.57 % | -78.32 % |
|    2     | -80.22 % | -79.89 % | -79.57 % | -79.58 % | -79.70 % | -80.10 % | -80.30 % |
|    4     | -81.10 % | -81.25 % | -81.40 % | -80.77 % | -80.15 % | -79.55 % | -79.55 % |
|    8     | -82.65 % | -82.83 % | -83.00 % | -83.33 % | -83.50 % | -83.65 % | -83.65 % |
+----------+----------+----------+----------+----------+----------+----------+----------+

$ bench --diff {O2,O1}/matmul

 O2/matmul vs O1/matmul
+----------+---------+---------+---------+---------+---------+---------+---------+
| #Threads |   Min   |   P10   |   P25   | Median  |   P75   |   P90   |   Max   |
+----------+---------+---------+---------+---------+---------+---------+---------+
|    1     | -0.28 s | -0.28 s | -0.28 s | -0.29 s | -0.30 s | -0.30 s | -0.31 s |
|    2     | -0.19 s | -0.20 s | -0.21 s | -0.21 s | -0.22 s | -0.21 s | -0.21 s |
|    4     | -0.11 s | -0.11 s | -0.11 s | -0.12 s | -0.12 s | -0.13 s | -0.13 s |
|    8     | -0.09 s | -0.09 s | -0.09 s | -0.09 s | -0.09 s | -0.09 s | -0.09 s |
+----------+---------+---------+---------+---------+---------+---------+---------+

 O2/matmul vs O1/matmul
+----------+----------+----------+----------+----------+----------+----------+----------+
| #Threads |   Min    |   P10    |   P25    |  Median  |   P75    |   P90    |   Max    |
+----------+----------+----------+----------+----------+----------+----------+----------+
|    1     | -45.16 % | -45.16 % | -45.16 % | -46.03 % | -46.15 % | -45.45 % | -46.27 % |
|    2     | -52.78 % | -54.05 % | -55.26 % | -53.85 % | -55.00 % | -52.50 % | -52.50 % |
|    4     | -45.83 % | -45.83 % | -45.83 % | -48.00 % | -46.15 % | -48.15 % | -48.15 % |
|    8     | -52.94 % | -52.94 % | -52.94 % | -52.94 % | -52.94 % | -52.94 % | -52.94 % |
+----------+----------+----------+----------+----------+----------+----------+----------+
```

## bench --plot

```console
$ bench --plot {O0,O1,O2}/matmul
# See plot.png
```
